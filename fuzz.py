import subprocess
import click


@click.group()
def cmd():
    pass


@cmd.command()
@click.option("-u", "--url", help="url to fuzz")
@click.option("-p", "--port", help="port ", default=80)
@click.option(
    "-w",
    "--wordlist",
    help="wordlist to fuzz with",
    default="/usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-directories.txt",
)
def ferox(url, port, wordlist):
    _ferox(url, port, wordlist)


def _ferox(url, port, wordlist):
    ferox_command = f"feroxbuster -u {url}:{port} -w {wordlist}"
    subprocess.run(ferox_command.split())


@cmd.command()
@click.option("-u", "--url", help="url to fuzz")
@click.option("-pf", "--ports_file", help="file containing a port to scan on each line")
@click.option(
    "-w",
    "--wordlist",
    help="wordlist to fuzz with",
    default="/usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-directories.txt",
)
def ferox_ports_file(url, ports_file, wordlist):
    ports = []
    with open(ports_file, "rt") as file:
        for line in file.readlines():
            ports.append(line)

    ports_string = ",".join(ports)

    _ferox_ports(url, ports_string, wordlist)


@cmd.command()
@click.option("-u", "--url", help="url to fuzz")
@click.option(
    "-p", "--ports", help="comma separated list of ports to scan ", default="80"
)
@click.option(
    "-w",
    "--wordlist",
    help="wordlist to fuzz with",
    default="/usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-directories.txt",
)
def ferox_ports(url, ports, wordlist):
    _ferox_ports(url, ports, wordlist)


def _ferox_ports(url, ports, wordlist):
    ports = ports.split(",")
    for port in ports:
        _ferox(url, port, wordlist)


if __name__ == "__main__":
    cmd()
